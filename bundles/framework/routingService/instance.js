/**
 * @class Oskari.mapframework.bundle.routingService.RoutingServiceBundleInstance
 */
Oskari.clazz.define('Oskari.mapframework.bundle.routingService.RoutingServiceBundleInstance',
/**
 * @static constructor function
 */
function () {
    this.sandbox = null;
    this.started = false;
    this._defaultStyles = {
        "marker": {
            "offsetX": 16,
            "offsetY": 0,
            "data":"<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path class='normal-color' fill='#e75d10' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g></svg>"
        },
        "marker_automobile": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 13.467427,11.012764 q 0,-0.30947 -0.220226,-0.529696 -0.220225,-0.220225 -0.529695,-0.220225 -0.309471,0 -0.529696,0.220225 -0.220226,0.220226 -0.220226,0.529696 0,0.309471 0.220226,0.529696 0.220225,0.220226 0.529696,0.220226 0.30947,0 0.529695,-0.220226 0.220226,-0.220225 0.220226,-0.529696 z m 0.168778,-1.5001049 4.762275,0 -0.417089,-1.6733454 q -0.0094,-0.037535 -0.06562,-0.082158 -0.05617,-0.044623 -0.09843,-0.044623 l -3.599727,0 q -0.04226,0 -0.09843,0.044623 -0.05617,0.044623 -0.06562,0.082158 z m 6.430896,1.5001049 q 0,-0.30947 -0.220225,-0.529696 -0.220226,-0.220225 -0.529696,-0.220225 -0.30947,0 -0.529696,0.220225 -0.220225,0.220226 -0.220225,0.529696 0,0.309471 0.220225,0.529696 0.220226,0.220226 0.529696,0.220226 0.30947,0 0.529696,-0.220226 0.220225,-0.220225 0.220225,-0.529696 z m 0.749922,-0.450162 0,1.799863 q 0,0.06562 -0.04226,0.107882 -0.04226,0.04226 -0.107881,0.04226 l -0.4499,0 0,0.600042 q 0,0.375092 -0.262486,0.637577 -0.262486,0.262486 -0.637577,0.262486 -0.375092,0 -0.637578,-0.262486 -0.262485,-0.262485 -0.262485,-0.637577 l 0,-0.600042 -4.799811,0 0,0.600042 q 0,0.375092 -0.262486,0.637577 -0.262486,0.262486 -0.637577,0.262486 -0.375092,0 -0.637578,-0.262486 -0.262485,-0.262485 -0.262485,-0.637577 l 0,-0.600042 -0.449901,0 q -0.06562,0 -0.107881,-0.04226 -0.04226,-0.04226 -0.04226,-0.107882 l 0,-1.799863 q 0,-0.435989 0.307108,-0.7428347 0.307108,-0.3068457 0.742834,-0.3071082 l 0.131243,0 0.49216,-1.9639169 q 0.107882,-0.4407133 0.487436,-0.7383719 0.379554,-0.2976587 0.838904,-0.2976587 l 3.599727,0 q 0.459349,0 0.838903,0.2976587 0.379555,0.2976586 0.487436,0.7383719 l 0.492161,1.9639169 0.131242,0 q 0.435989,0 0.742834,0.3071082 0.306846,0.3071077 0.307109,0.7428347 z' fill='#333333' /></svg>"
        },
        "marker_bike": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path fill='#333333' d='m 18.79375,14.141018 c 0.7689,0 1.4064,-0.6189 1.4064,-1.3875 0,-0.7686 -0.6375,-1.4064 -1.4064,-1.4064 -0.7689,0 -1.3875,0.6375 -1.3875,1.4064 0,0.7689 0.6189,1.3875 1.3875,1.3875 z m 0,-3.3939 c 1.125,0 2.0064,0.8814 2.0064,2.0064 0,1.125 -0.8814,1.9875 -2.0064,1.9875 -1.125,0 -1.9875,-0.8625 -1.9875,-1.9875 0,-1.125 0.8625,-2.0064 1.9875,-2.0064 z m -3.2814,-0.6 0.8814,0.9189 0,2.475 -0.7875,0 0,-1.9875 -1.2939,-1.125 c -0.1689,-0.1125 -0.225,-0.3189 -0.225,-0.5625 0,-0.2064 0.0564,-0.3939 0.225,-0.5625 l 1.125,-1.125 c 0.1125,-0.1689 0.3189,-0.225 0.5625,-0.225 0.2436,0 0.4314,0.0564 0.6375,0.225 l 0.7689,0.7689 c 0.3564,0.3564 0.825,0.6 1.425,0.6 l 0,0.8064 c -0.8439,0 -1.5,-0.3189 -2.025,-0.8439 l -0.3189,-0.3189 z m -2.3061,3.9939 c 0.7689,0 1.3875,-0.6189 1.3875,-1.3875 0,-0.7686 -0.6189,-1.4064 -1.3875,-1.4064 -0.7686,0 -1.4064,0.6375 -1.4064,1.4064 0,0.7689 0.6375,1.3875 1.4064,1.3875 z m 0,-3.3939 c 1.125,0 1.9875,0.8814 1.9875,2.0064 0,1.125 -0.8625,1.9875 -1.9875,1.9875 -1.125,0 -2.0064,-0.8625 -2.0064,-1.9875 0,-1.125 0.8814,-2.0064 2.0064,-2.0064 z m 4.2,-2.6061 c -0.4314,0 -0.8064,-0.3564 -0.8064,-0.7875 0,-0.4311 0.375,-0.8064 0.8064,-0.8064 0.4314,0 0.7875,0.375 0.7875,0.8064 0,0.4314 -0.3564,0.7875 -0.7875,0.7875 z' /></svg>"
        },
        "marker_bus": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 13.959849,12.357968 q 0,-0.2838 -0.201,-0.4848 -0.201,-0.201 -0.4848,-0.201 -0.2838,0 -0.4848,0.201 -0.201,0.201 -0.201,0.4848 0,0.2838 0.201,0.4848 0.201,0.201 0.4848,0.201 0.2838,0 0.4848,-0.201 0.201,-0.201 0.201,-0.4848 z m 5.4858,0 q 0,-0.2838 -0.201,-0.4848 -0.201,-0.201 -0.4848,-0.201 -0.2838,0 -0.4848,0.201 -0.201,0.201 -0.201,0.4848 0,0.2838 0.201,0.4848 0.201,0.201 0.4848,0.201 0.2838,0 0.4848,-0.201 0.201,-0.201 0.201,-0.4848 z m -0.2466,-2.1213 -0.3858,-2.0571005 q -0.0267,-0.1233 -0.1206,-0.201 -0.0939,-0.0777 -0.2169,-0.0777 l -4.9179,0 q -0.1233,0 -0.2169,0.0777 -0.0936,0.0777 -0.1206,0.201 l -0.3858,2.0571005 q -0.0267,0.1608 0.075,0.2838 0.1017,0.123 0.2625,0.1233 l 5.6892,0 q 0.1608,0 0.2625,-0.1233 0.1017,-0.1233 0.075,-0.2838 z m -1.2105,-3.2787005 q 0,-0.1071 -0.075,-0.1821 -0.075,-0.075 -0.1821,-0.075 l -3.4287,0 q -0.1071,0 -0.1821,0.075 -0.075,0.075 -0.075,0.1821 0,0.1071 0.075,0.1821 0.075,0.075 0.1821,0.075 l 3.4287,0 q 0.1071,0 0.1821,-0.075 0.075,-0.075 0.075,-0.1821 z m 2.1429,3.8841005 0,3.2304 -0.6858,0 0,0.6858 q 0,0.2838 -0.201,0.4848 -0.201,0.201 -0.4848,0.201 -0.2838,0 -0.4848,-0.201 -0.201,-0.201 -0.201,-0.4848 l 0,-0.6858 -4.1142,0 0,0.6858 q 0,0.2838 -0.201,0.4848 -0.201,0.201 -0.4848,0.201 -0.2838,0 -0.4848,-0.201 -0.201,-0.201 -0.201,-0.4848 l 0,-0.6858 -0.6858,0 0,-3.2304 q 0,-0.6 0.1338,-1.1946005 l 0.5517,-2.4321 q 0.0483,-0.4179 0.5223,-0.7338 0.474,-0.3159 1.2321,-0.4767 0.7581,-0.1608 1.674,-0.1608 0.9159,0 1.674,0.1608 0.7581,0.1608 1.2321,0.4767 0.474,0.3159 0.5223,0.7338 l 0.5625,2.4321 q 0.1233,0.5463005 0.1233,1.1946005 z' fill='#333333' /></svg>"
        },
        "marker_flag": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 14.803885,12.258455 0,-1.004145 c -0.64974,0.05907 -1.32902,0.265803 -2.03782,0.620207 l 0,0.974611 c 0.73834,-0.354404 1.41761,-0.56114 2.03782,-0.590673 z m 0,-2.215026 0,-1.0336791 c -0.62021,0.02953 -1.26995,0.23627 -2.03782,0.679275 l 0,1.0041451 c 0.76787,-0.413472 1.44715,-0.620208 2.03782,-0.649741 z m 4.40052,2.451295 0,-0.974611 c -0.82695,0.413471 -1.50622,0.531606 -2.03783,0.383937 l 0,-1.181347 c -0.0591,-0.02953 -0.14766,-0.05907 -0.20673,-0.0886 -0.0295,0 -0.0886,-0.02953 -0.1772,-0.0886 -0.0886,-0.05907 -0.14767,-0.0886 -0.1772,-0.0886 -0.0295,0 -0.0886,-0.02953 -0.17721,-0.0886 -0.0886,-0.02953 -0.14766,-0.05907 -0.1772,-0.0886 -0.0295,0 -0.0886,-0.02953 -0.1772,-0.05907 -0.0886,-0.02953 -0.14767,-0.05907 -0.1772,-0.05907 -0.0591,0 -0.11814,-0.02953 -0.17721,-0.05907 -0.0886,-0.02953 -0.14766,-0.02953 -0.20673,-0.02953 -0.0591,0 -0.11814,0 -0.20674,-0.02953 -0.0886,0 -0.14767,0 -0.23627,0 -0.0886,0 -0.1772,0 -0.2658,0.02953 l 0,1.181347 0.0886,0 c 0.35441,0 0.70881,0.05907 1.00415,0.147669 0.32487,0.0886 0.67927,0.236269 1.03368,0.443005 0.0591,0.02953 0.14766,0.05907 0.20673,0.0886 l 0,1.004145 c 0.14767,0.05907 0.29534,0.0886 0.47254,0.0886 0.47254,-0.05907 0.97461,-0.206735 1.59482,-0.531606 l 0,0 z m 0,-2.274093 0,-1.0041451 c -0.59067,0.32487 -1.12228,0.472539 -1.62435,0.472539 -0.14767,0 -0.29534,0 -0.41348,-0.02953 l 0,1.0336781 c 0.53161,0.177202 1.21088,0 2.03783,-0.472538 z m 0.67927,-1.5652851 0,4.0461141 c 0,0.147668 -0.0591,0.236269 -0.1772,0.295337 -0.0296,0.02953 -0.0591,0.02953 -0.0886,0.05907 -0.76788,0.413471 -1.41762,0.620207 -1.94922,0.620207 -0.29534,0 -0.59068,-0.05907 -0.82695,-0.177202 l -0.14767,-0.0886 c -0.23626,-0.118135 -0.41346,-0.206736 -0.5316,-0.265803 -0.11814,-0.05907 -0.29534,-0.118135 -0.47254,-0.147669 -0.20674,-0.05907 -0.38394,-0.0886 -0.59067,-0.0886 -0.35441,0 -0.76788,0.0886 -1.24042,0.23627 -0.47254,0.147668 -0.88601,0.32487 -1.21088,0.531606 -0.0591,0.02953 -0.11813,0.05907 -0.1772,0.05907 -0.0591,0 -0.11814,0 -0.1772,-0.02953 -0.11814,-0.05907 -0.1772,-0.177201 -0.1772,-0.295335 l 0,-3.9279791 c 0,-0.118135 0.0591,-0.206736 0.1772,-0.295337 0.11813,-0.0886 0.2658,-0.147668 0.41347,-0.236269 0.14767,-0.0886 0.3544,-0.177202 0.59067,-0.265804 0.23627,-0.118134 0.53161,-0.206735 0.79741,-0.265803 0.2658,-0.059067 0.56114,-0.088601 0.82695,-0.088601 0.38393,0 0.76787,0.059067 1.09274,0.1772016 0.3544,0.118135 0.70881,0.265804 1.09275,0.443006 0.14767,0.05907 0.29533,0.0886 0.47254,0.0886 0.443,0 0.97461,-0.206736 1.62435,-0.590674 0.0886,-0.02953 0.11813,-0.05907 0.1772,-0.088601 0.11814,-0.059067 0.20674,-0.059067 0.32487,0 0.11814,0.088601 0.1772,0.1772019 0.1772,0.2953369 l 0,0 z' fill='#333333' /></svg>"
        },
        "marker_metro": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32' ><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000015,20.792533)' ><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 12.1365,14.850366 0,-7.9998461 2.417416,0 1.451541,5.4569211 1.43517,-5.4569211 2.422873,0 0,7.9998461 -1.500654,0 0,-6.2972869 -1.587964,6.2972869 -1.555222,0 -1.582507,-6.2972869 0,6.2972869 -1.500653,0 z' fill='000000' /></svg>"
        },
        "marker_train": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 17.71405,6.225424 q 0.9912,0 1.6956,0.501 0.7044,0.501 0.7044,1.2135 l 0,4.8 q 0,0.6963 -0.6723,1.1892 -0.6723,0.4929 -1.6365,0.5196 l 1.1412,1.0821 q 0.0858,0.0804 0.0429,0.1875 -0.0429,0.1071 -0.1608,0.1071 l -5.6571,0 q -0.1179,0 -0.1608,-0.1071 -0.0429,-0.1071 0.0429,-0.1875 l 1.1412,-1.0821 q -0.9642,-0.0267 -1.6365,-0.5196 -0.6723,-0.4929 -0.6723,-1.1892 l 0,-4.8 q 0,-0.7125 0.7044,-1.2135 0.7044,-0.501 1.6956,-0.501 l 3.4287,0 z m -1.7145,7.2 q 0.4287,0 0.7287,-0.3 0.3,-0.3 0.3,-0.7287 0,-0.4287 -0.3,-0.7287 -0.3,-0.3 -0.7287,-0.3 -0.4287,0 -0.7287,0.3 -0.3,0.3 -0.3,0.7287 0,0.4287 0.3,0.7287 0.3,0.3 0.7287,0.3 z m 3.0858,-3.0858 0,-2.7429 -6.1713,0 0,2.7429 6.1713,0 z' fill='#333333' /></svg>"
        },
        "marker_tram1": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path fill='#333333' d='m 18.00655,11.831674 0,-2.0064003 -4.0125,0 0,2.0064003 4.0125,0 z m -2.0064,1.8 c 0.3375,0 0.6,-0.2625 0.6,-0.6 0,-0.3375 -0.2625,-0.6 -0.6,-0.6 -0.3375,0 -0.6,0.2625 -0.6,0.6 0,0.3375 0.2625,0.6 0.6,0.6 z m 2.7939,-0.6375 c 0,0.675 -0.3564,1.2375 -1.0314,1.2375 l 0.0375,0 0.6,0.6 0,0.1875 -0.8064,0 -0.7875,-0.7875 -1.5189,0 -0.7875,0.7875 -0.9,0 0,-0.1875 0.6375,-0.6375 c -0.5625,-0.1314 -1.0314,-0.6189 -1.0314,-1.2 l 0,-3.3750003 c 0,-1.1064 1.125,-1.35 2.3814,-1.3875 l 0.3189,-0.6 -1.9125,0 0,-0.6 4.0125,0 0,0.6 -1.3125,0 -0.3,0.6 c 1.3689,0.0375 2.4,0.2625 2.4,1.3875 l 0,3.3750003 z'/></svg>"
        },
        "marker_tram2": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001' /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 17.71405,6.2254234 q 0.9912,0 1.6956,0.501 0.7044,0.501 0.7044,1.2135001 l 0,4.7999995 q 0,0.6963 -0.6723,1.1892 -0.6723,0.4929 -1.6365,0.5196 l 1.1412,1.0821 q 0.0858,0.0804 0.0429,0.1875 -0.0429,0.1071 -0.1608,0.1071 l -5.6571,0 q -0.1179,0 -0.1608,-0.1071 -0.0429,-0.1071 0.0429,-0.1875 l 1.1412,-1.0821 q -0.9642,-0.0267 -1.6365,-0.5196 -0.6723,-0.4929 -0.6723,-1.1892 l 0,-4.7999995 q 0,-0.7125001 0.7044,-1.2135001 0.7044,-0.501 1.6956,-0.501 l 3.4287,0 z m -4.2858,7.0286996 q 0.3537,0 0.6054,-0.2517 0.2517,-0.2517 0.2517,-0.6054 0,-0.3537 -0.2517,-0.6054 -0.2517,-0.2517 -0.6054,-0.2517 -0.3537,0 -0.6054,0.2517 -0.2517,0.2517 -0.2517,0.6054 0,0.3537 0.2517,0.6054 0.2517,0.2517 0.6054,0.2517 z m 2.2284,-2.9145 0,-2.7428996 -2.9142,0 0,2.7428996 2.9142,0 z m 2.9145,2.9145 q 0.3537,0 0.6054,-0.2517 0.2517,-0.2517 0.2517,-0.6054 0,-0.3537 -0.2517,-0.6054 -0.2517,-0.2517 -0.6054,-0.2517 -0.3537,0 -0.6054,0.2517 -0.2517,0.2517 -0.2517,0.6054 0,0.3537 0.2517,0.6054 0.2517,0.2517 0.6054,0.2517 z m 0.8571,-2.9145 0,-2.7428996 -3.0858,0 0,2.7428996 3.0858,0 z' fill='#333333' /></svg>"
        },
        "marker_walk": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000015,20.792533)' ><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z'/><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001'/><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z'/></g><path d='m 14.562,9.1190367 -1.5,7.5252003 1.1252,0 0.9752,-4.2752 1.1,1.0752 0,3.2 1.0752,0 0,-4 -1.1252,-1.0752 0.3252,-1.6000004 c 0.7,0.8000004 1.75,1.3252004 2.9252,1.3252004 l 0,-1.05 c -1.0252,0 -1.85,-0.5500004 -2.2752,-1.3000003 l -0.55,-0.85 c -0.2252,-0.3252 -0.5252,-0.5252 -0.9,-0.5252 -0.15,0 -0.2752,0.05 -0.4252,0.05 l -2.7752,1.1752 0,2.5000003 1.0752,0 0,-1.8000004 0.95,-0.3751999 z m 1.9748,-1.8248 c -0.5752,0 -1.0752,-0.4752001 -1.0752,-1.0500001 0,-0.5748 0.5,-1.0752 1.0752,-1.0752 0.5752,0 1.0752,0.5 1.0752,1.0752 0,0.5752 -0.5,1.0500001 -1.0752,1.0500001 z' fill='#333333' /></svg>"
        },
        "marker_flight": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z'/><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001'/><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z' id='path3364' /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z' /></g><path d='m 20.5635,12.62755 -3.853726,-1.194555 0,2.636818 0.9692,0.721131 0,0.721131 -1.690332,-0.473422 -1.667616,0.473422 0,-0.721131 0.946485,-0.721131 0,-2.636818 -3.831011,1.194555 0,-0.946485 3.831011,-2.4114632 0,-2.636817 c 0,-0.405636 0.315495,-0.721131 0.721131,-0.721131 0.405637,0 0.721132,0.315495 0.721132,0.721131 l 0,2.636817 3.853726,2.4114632 0,0.946485 z' style='fill:#333333' /></svg>"
        },
        "marker_ferry": {
            "offsetX": 16,
            "offsetY": 0,
            "data": "<svg width='32' height='32'><g transform='matrix(0.36866667,0,0,0.36866667,-0.59000005,20.792533)'><path fill='#b94b20' class='shading-color' d='m 75,-26.4 c 0,14.3 -20.4,34.5 -27.7,55.2 -0.7,2.1 -3.7,2.1 -4.5,0 C 35.9,8.1 15,-12.1 15,-26.4 c 0,-16.6 13.4,-30 30,-30 16.6,0 30,13.4 30,30 z' /><circle fill='#e5e5e5' r='20' cy='-26.6' cx='45.200001'  /><path fill='#ffffff' d='m 44.8,-46.6 c -11.1,0.2 -20,9 -20,20 0,11 8.9,19.8 20,20 l 0,-40 z'  /><path fill='#e75d10' class='normal-color' d='m 44.9,-6.6 c -10.9,-0.2 -19.7,-9 -19.7,-20 0,-11 8.8,-19.8 19.7,-20 l 0,-9.8 c -16.5,0.1 -29.9,13.5 -29.9,30 0,14.3 20.9,34.5 27.9,55.2 0.3,1 1.1,1.5 2,1.6 l 0,-37 z'  /></g><path d='m 13.385499,7.9622614 0,1.736138 2.614173,-0.857776 2.614173,0.857776 0,-1.736138 -5.228346,0 z M 12.486877,13.619659 11.669948,10.71956 c -0.0977,-0.293114 0.08137,-0.483295 0.285925,-0.55159 l 0.551591,-0.1839722 0,-2.0220634 c 0,-0.469897 0.408464,-0.878362 0.878362,-0.878362 l 1.307086,0 0,-1.307086 2.614174,0 0,1.307086 1.307086,0 c 0.469898,0 0.878362,0.408465 0.878362,0.878362 l 0,2.0220634 0.551591,0.1839722 c 0.204559,0.0683 0.38363,0.258149 0.285925,0.55159 l -0.816929,2.900099 -0.02059,0 c -0.694389,0 -1.327673,-0.367618 -1.756397,-0.857776 -0.429051,0.490158 -1.041748,0.857776 -1.736138,0.857776 -0.69439,0 -1.307087,-0.367618 -1.736138,-0.857776 -0.429051,0.490158 -1.062008,0.857776 -1.756397,0.857776 l -0.02059,0 z m 7.005331,0.878035 0.857775,0 0,0.878362 -0.857775,0 c -0.592437,0 -1.205134,-0.143126 -1.756398,-0.429051 -1.102854,0.571851 -2.369094,0.571851 -3.471949,0 -0.55159,0.285925 -1.164287,0.429051 -1.756397,0.429051 l -0.857776,0 0,-0.878362 0.857776,0 c 0.612696,0 1.225393,-0.204232 1.756397,-0.57185 1.062008,0.735236 2.409941,0.735236 3.471949,0 0.531004,0.367618 1.143701,0.57185 1.756398,0.57185 z' style='fill:#333333' /></svg>"
        },
        "bus_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g transform='scale(0.5,0.5)'><rect y='32' x='0' height='32' width='32' fill='#666666' /><path fill='#ffffff' d='m 10.428688,52.141812 q 0,-0.768625 -0.5443748,-1.313 -0.544375,-0.544375 -1.313,-0.544375 -0.768625,0 -1.313,0.544375 -0.544375,0.544375 -0.544375,1.313 0,0.768625 0.544375,1.313 0.544375,0.544375 1.313,0.544375 0.768625,0 1.313,-0.544375 0.5443748,-0.544375 0.5443748,-1.313 z m 14.857374,0 q 0,-0.768625 -0.544375,-1.313 -0.544375,-0.544375 -1.313,-0.544375 -0.768625,0 -1.313,0.544375 -0.544375,0.544375 -0.544375,1.313 0,0.768625 0.544375,1.313 0.544375,0.544375 1.313,0.544375 0.768625,0 1.313,-0.544375 0.544375,-0.544375 0.544375,-1.313 z M 24.618187,46.396625 23.573312,40.825313 Q 23.501,40.491375 23.246687,40.280938 22.992375,40.0705 22.65925,40.0705 l -13.3193117,0 q -0.333938,0 -0.5874381,0.210438 -0.2535,0.210437 -0.326625,0.544375 l -1.044875,5.571312 q -0.07231,0.4355 0.203125,0.768625 0.275438,0.333125 0.7109381,0.333937 l 15.4082487,0 q 0.4355,0 0.710938,-0.333937 0.275437,-0.333938 0.203125,-0.768625 z M 21.33975,37.516813 q 0,-0.290063 -0.203125,-0.493188 Q 20.9335,36.8205 20.643437,36.8205 l -9.286062,0 q -0.290062,0 -0.493187,0.203125 -0.203125,0.203125 -0.203125,0.493188 0,0.290062 0.203125,0.493187 0.203125,0.203125 0.493187,0.203125 l 9.286062,0 q 0.290063,0 0.493188,-0.203125 0.203125,-0.203125 0.203125,-0.493187 z m 5.803687,10.519437 0,8.749 -1.857375,0 0,1.857375 q 0,0.768625 -0.544375,1.313 Q 24.197312,60.5 23.428687,60.5 q -0.768625,0 -1.313,-0.544375 -0.544375,-0.544375 -0.544375,-1.313 l 0,-1.857375 -11.142624,0 0,1.857375 q 0,0.768625 -0.5443747,1.313 Q 9.3399383,60.5 8.5713132,60.5 q -0.768625,0 -1.313,-0.544375 -0.544375,-0.544375 -0.544375,-1.313 l 0,-1.857375 -1.8573755,0 0,-8.749 q 0,-1.625 0.362375,-3.235375 L 6.7131252,38.213938 Q 6.8439382,37.082125 8.1276882,36.226563 9.4114383,35.371 11.464625,34.9355 13.517813,34.5 15.998375,34.5 q 2.480562,0 4.53375,0.4355 2.053187,0.4355 3.336937,1.291063 1.28375,0.855562 1.414563,1.987375 l 1.523437,6.586937 Q 27.141,46.280437 27.141,48.03625 Z' /></g></svg>"
        },
        "metro_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><rect fill='#666666' width='16' height='16' x='0' y='16' /><path d='m 2.2046388,30 0,-11.999999 3.6261935,0 2.1773533,8.185538 2.1527964,-8.185538 3.634379,0 0,11.999999 -2.251023,0 0,-9.446111 L 9.1623465,30 6.829468,30 4.4556619,20.553889 l 0,9.446111 -2.2510231,0 z' fill='#ffffff'/></svg>"
        },
        "train_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g transform='scale(0.5,0.5)'><rect y='32' x='0' height='32' width='32' fill='#666666' /><path fill='#ffffff' d='m 20.642219,35 q 2.6845,0 4.59225,1.356875 1.90775,1.356875 1.90775,3.286563 l 0,12.999999 q 0,1.885813 -1.820813,3.22075 -1.820812,1.334938 -4.432187,1.40725 l 3.09075,2.930688 q 0.232375,0.21775 0.116187,0.507812 Q 23.979969,61 23.660656,61 L 8.3393437,61 q -0.3193125,0 -0.4355,-0.290063 -0.1161875,-0.290062 0.1161875,-0.507812 L 11.110781,57.271437 Q 8.4994063,57.199125 6.6785937,55.864187 4.8577813,54.52925 4.8577813,52.643437 l 0,-12.999999 q 0,-1.929688 1.90775,-3.286563 Q 8.6732813,35 11.357781,35 l 9.286063,0 z m -4.643438,19.5 q 1.161063,0 1.973563,-0.8125 0.8125,-0.8125 0.8125,-1.973563 0,-1.161062 -0.8125,-1.973562 -0.8125,-0.8125 -1.973563,-0.8125 -1.161062,0 -1.973562,0.8125 -0.8125,0.8125 -0.8125,1.973562 0,1.161063 0.8125,1.973563 0.8125,0.8125 1.973562,0.8125 z m 8.357375,-8.357375 0,-7.428687 -16.7139373,0 0,7.428687 16.7139373,0 z' /></g></svg>"
        },
        "tram1_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g transform='scale(0.5,0.5)'><rect y='32' x='0' height='32' width='32' fill='#666666' /><path fill='#ffffff' d='m 22.531584,50.624451 0,-6.531096 -13.0612148,0 0,6.531096 13.0612148,0 z m -6.531096,5.859236 c 1.098607,0 1.953079,-0.854472 1.953079,-1.953079 0,-1.098606 -0.854472,-1.953078 -1.953079,-1.953078 -1.098607,0 -1.953079,0.854472 -1.953079,1.953078 0,1.098607 0.854472,1.953079 1.953079,1.953079 z M 25.095,54.40854 c 0,2.197215 -1.160129,4.028226 -3.357343,4.028226 l 0.122068,0 1.953079,1.953079 0,0.610337 -2.624938,0 -2.563416,-2.563416 -4.944219,0 -2.563416,2.563416 -2.9296186,0 0,-0.610337 2.0751466,-2.075146 C 8.4313312,57.886972 6.9050001,56.300097 6.9050001,54.40854 l 0,-10.986069 c 0,-3.601478 3.6620229,-4.394427 7.7517699,-4.516494 l 1.038061,-1.95308 -6.2254384,0 0,-1.953079 13.0612144,0 0,1.953079 -4.27236,0 -0.976539,1.95308 c 4.455949,0.122067 7.812315,0.854472 7.812315,4.516494 l 0,10.986069 z' /></g></svg>"
        },
        "tram2_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g transform='scale(0.5,0.5)'><rect y='32' x='0' height='32' width='32' fill='#666666' /><path fill='#ffffff' d='m 20.642219,34.432717 q 2.6845,0 4.59225,1.356875 1.90775,1.356875 1.90775,3.286563 l 0,12.999999 q 0,1.885813 -1.820813,3.22075 -1.820812,1.334938 -4.432187,1.40725 l 3.09075,2.930688 q 0.232375,0.21775 0.116187,0.507812 -0.116187,0.290063 -0.4355,0.290063 l -15.3213127,0 q -0.3193125,0 -0.4355,-0.290063 -0.1161875,-0.290062 0.1161875,-0.507812 L 11.110781,56.704154 Q 8.4994058,56.631844 6.6785933,55.296904 4.8577808,53.961967 4.8577808,52.076154 l 0,-12.999999 q 0,-1.929688 1.90775,-3.286563 1.90775,-1.356875 4.5922502,-1.356875 l 9.286063,0 z M 9.0348433,53.468779 q 0.9579375,0 1.6396247,-0.681687 0.681688,-0.681688 0.681688,-1.639625 0,-0.957938 -0.681688,-1.639625 -0.6816872,-0.681688 -1.6396247,-0.681688 -0.9579375,0 -1.639625,0.681688 -0.6816875,0.681687 -0.6816875,1.639625 0,0.957937 0.6816875,1.639625 0.6816875,0.681687 1.639625,0.681687 z m 6.0352507,-7.893437 0,-7.428687 -7.8926257,0 0,7.428687 7.8926257,0 z m 7.893437,7.893437 q 0.957938,0 1.639625,-0.681687 0.681688,-0.681688 0.681688,-1.639625 0,-0.957938 -0.681688,-1.639625 -0.681687,-0.681688 -1.639625,-0.681688 -0.957937,0 -1.639625,0.681688 -0.681687,0.681687 -0.681687,1.639625 0,0.957937 0.681687,1.639625 0.681688,0.681687 1.639625,0.681687 z m 2.321313,-7.893437 0,-7.428687 -8.357375,0 0,7.428687 8.357375,0 z' /></g></svg>"
        },
        "flight_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g><rect y='16' x='0' height='16' width='16' style='fill:#666666' /><path style='fill:#ffffff' d='m 14.179501,26.594024 -5.218386,-1.617564 0,3.570552 1.312407,0.976494 0,0.976494 L 7.98462,29.858932 5.726478,30.5 l 0,-0.976494 1.281648,-0.976494 0,-3.570552 -5.187626,1.617564 0,-1.281649 5.187626,-3.265398 0,-3.570551 c 0,-0.549278 0.427217,-0.976494 0.976494,-0.976494 0.549279,0 0.976495,0.427216 0.976495,0.976494 l 0,3.570551 5.218386,3.265398 0,1.281649 z' /></g></svg>"
        },
        "ferry_stop": {
            "offsetX": 8,
            "offsetY": 8,
            "data": "<svg width='32' height='32'><g><rect y='16' x='0' height='16' width='16' style='fill:#666666' /><path style='fill:#ffffff' d='m 4.4594179,20.460037 0,2.351125 3.540184,-1.161623 3.5401851,1.161623 0,-2.351125 -7.0803691,0 z m -1.216938,7.661402 -1.106308,-3.927393 c -0.132314,-0.396943 0.110188,-0.654491 0.387208,-0.746979 l 0.746979,-0.24914 0,-2.738333 c 0,-0.636348 0.553153,-1.189502 1.189502,-1.189502 l 1.770092,0 0,-1.770092 3.5401841,0 0,1.770092 1.770092,0 c 0.636349,0 1.189502,0.553154 1.189502,1.189502 l 0,2.738333 0.746979,0.24914 c 0.27702,0.09249 0.519522,0.349594 0.387208,0.746979 l -1.106308,3.927393 -0.02788,0 c -0.940361,0 -1.797971,-0.497839 -2.378561,-1.161623 -0.581033,0.663784 -1.410763,1.161623 -2.3511251,1.161623 -0.940362,0 -1.770092,-0.497839 -2.351125,-1.161623 -0.581033,0.663784 -1.4382,1.161623 -2.378561,1.161623 l -0.02788,0 z m 9.4868091,1.189059 1.161623,0 0,1.189502 -1.161623,0 c -0.802294,0 -1.632025,-0.193825 -2.378561,-0.581033 -1.493516,0.774416 -3.2082931,0.774416 -4.7018081,0 C 4.9019409,30.306175 4.0722099,30.5 3.2703589,30.5 l -1.161624,0 0,-1.189502 1.161624,0 c 0.82973,0 1.659461,-0.276577 2.378561,-0.774415 1.4382,0.995677 3.2636081,0.995677 4.7018081,0 0.719099,0.497838 1.54883,0.774415 2.378561,0.774415 z' /></g></svg>"
        }

    };
}, {
    __name: 'routingService',

    /**
     * @method getName
     * @return {String} the name for the component
     */
    getName: function () {
        return this.__name;
    },

    /**
     * @method init
     * Initializes the service
     */
    init: function () {
        var me = this;
        this.requestHandlers = {
            getRouteHandler: Oskari.clazz.create('Oskari.mapframework.bundle.routeService.request.GetRouteRequestHandler', me)
        };
        return null;
    },
    /**
     * Registers itself to the sandbox, creates the tab and the service
     * and adds the flyout.
     *
     * @method start
     */
    start: function () {
        var me = this,
            conf = me.conf,
            sandboxName = (conf ? conf.sandbox : null) || 'sandbox',
            sandbox = Oskari.getSandbox(sandboxName);

        this.sandbox = sandbox;
        sandbox.register(this);

        sandbox.addRequestHandler('GetRouteRequest', this.requestHandlers.getRouteHandler);

        var reqBuilder = sandbox.getRequestBuilder('MapModulePlugin.RegisterStyleRequest');
        if(reqBuilder) {
            var request = reqBuilder('routing', me._defaultStyles);
            sandbox.request(this, request);
        }
    },

        /**
         * @method onEvent
         * @param {Oskari.mapframework.event.Event} event a Oskari event
         * object
         * Event is handled forwarded to correct #eventHandlers if found
         * or discarded if not.
         */
        onEvent: function (event) {
            var handler = this.eventHandlers[event.getName()];
            if (!handler) {
                return;
            }

            return handler.apply(this, [event]);
        },

    /**
     * @method getRoute
     * Makes the ajax call to get the route from service
     * @param {Object} parameters of the route. Possible values are:
     *                 srs - *required
     *                 lang - fi/sv/en
     *                 fromlat - x coordinate of the starting point *required
     *                 fromlon - y coordinate of the starting point *required
     *                 tolat - x coordinate of the destination point *required
     *                 tolon - y coordinate of the destination point *required
     *                 date - YYYYMMDD
     *                 time - HHMM
     *                 timetype - {Boolean} true if is departure time, false if arrival time
     *                 vialat - x coordinate of the via point
     *                 vialon - y coordinate of the via point
     *                 via_time - Minimum time spent at a via_point in minutes
     *                 zone - Ticket zone
     *                 transport_types
     */
    getRoute: function (params) {
        var me = this;
            getRouteUrl = this.sandbox.getAjaxUrl() + 'action_route=Routing';

        jQuery.ajax({
            data: params,
            dataType : "json",
            type : "GET",
            beforeSend: function(x) {
              if(x && x.overrideMimeType) {
               x.overrideMimeType("application/json");
              }
             },
            url : getRouteUrl,
            error : this.routeError,
            success : function (response) {
                var success = response.success,
                    requestParameters = response.requestParameters,
                    plan = response.plan;

                var evt = me.sandbox.getEventBuilder('RouteResultEvent')(success, requestParameters, plan);
                me.sandbox.notifyAll(evt);
            }
        });
    },

    routeError: function (response) {
        // TODO: send an event about failure (for RPC etc)
    }
});